{% extends "layouts/base.html" %}
{% block title %}TWStock Pro｜台灣股市即時行情與分析平台{% endblock %}

{% block extra_css %}
<style>
    /* ── Hero ── */
    .hero {
        padding: 72px 0 52px;
        text-align: center;
        position: relative;
        overflow: hidden;
    }

    .hero-bg {
        position: absolute;
        inset: 0;
        pointer-events: none;
        background:
            radial-gradient(ellipse 900px 400px at 50% -60px, rgba(59, 130, 246, 0.07) 0%, transparent 70%),
            radial-gradient(ellipse 500px 300px at 20% 80%, rgba(139, 92, 246, 0.04) 0%, transparent 60%);
    }

    .hero-grid-bg {
        position: absolute;
        inset: 0;
        background-image:
            linear-gradient(rgba(255, 255, 255, 0.025) 1px, transparent 1px),
            linear-gradient(90deg, rgba(255, 255, 255, 0.025) 1px, transparent 1px);
        background-size: 56px 56px;
        mask-image: radial-gradient(ellipse 80% 60% at 50% 40%, black 20%, transparent 80%);
    }

    .hero-eyebrow {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 3px 14px;
        border-radius: var(--r-full);
        background: rgba(59, 130, 246, 0.08);
        border: 1px solid rgba(59, 130, 246, 0.18);
        font-size: var(--text-xs);
        font-weight: 700;
        color: var(--c-blue);
        letter-spacing: 0.1em;
        text-transform: uppercase;
        margin-bottom: 22px;
    }

    .hero-title {
        font-size: clamp(30px, 5vw, 52px);
        font-weight: 800;
        letter-spacing: -0.035em;
        line-height: 1.1;
        color: var(--t-white);
        margin-bottom: 16px;
    }

    .hero-title .accent {
        background: linear-gradient(135deg, var(--c-blue), #818CF8);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .hero-sub {
        font-size: var(--text-md);
        color: var(--t-secondary);
        max-width: 500px;
        margin: 0 auto 36px;
        line-height: 1.75;
    }

    /* Hero search */
    .hero-search {
        max-width: 560px;
        margin: 0 auto 24px;
    }

    .hero-search-box {
        display: flex;
        background: var(--bg-panel);
        border: 1px solid var(--b-medium);
        border-radius: 14px;
        padding: 5px;
        gap: 5px;
        box-shadow: 0 8px 40px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.03);
        transition: border-color var(--ease-md), box-shadow var(--ease-md);
    }

    .hero-search-box:focus-within {
        border-color: var(--b-brand);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.12), 0 8px 40px rgba(0, 0, 0, 0.3);
    }

    .hero-search-box input {
        flex: 1;
        background: transparent;
        border: none;
        outline: none;
        padding: 10px 14px;
        font-size: var(--text-md);
        color: var(--t-primary);
        font-family: var(--font);
    }

    .hero-search-box input::placeholder {
        color: var(--t-muted);
    }

    .hero-search-box button {
        background: var(--c-blue);
        border: none;
        border-radius: 10px;
        padding: 10px 22px;
        color: #fff;
        font-size: 13.5px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 7px;
        white-space: nowrap;
        transition: filter var(--ease), box-shadow var(--ease);
        font-family: var(--font);
        box-shadow: 0 1px 4px rgba(59, 130, 246, 0.3);
    }

    .hero-search-box button:hover {
        filter: brightness(1.1);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }

    /* Quick links */
    .quick-links {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        justify-content: center;
        margin-top: 14px;
    }

    .quick-link {
        padding: 3px 11px;
        border-radius: var(--r-full);
        background: var(--bg-elevated);
        border: 1px solid var(--b-default);
        font-size: var(--text-xs);
        color: var(--t-secondary);
        text-decoration: none;
        transition: all var(--ease);
    }

    .quick-link:hover {
        border-color: var(--b-brand);
        color: var(--c-blue);
        background: var(--bg-active);
    }

    .home-content {
        padding-bottom: 72px;
    }

    /* Section header */
    .sec-head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 18px;
        flex-wrap: wrap;
        gap: 8px;
    }

    .sec-title {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: var(--text-xs);
        font-weight: 700;
        color: var(--t-secondary);
        text-transform: uppercase;
        letter-spacing: 0.09em;
    }

    .sec-title-bar {
        width: 3px;
        height: 15px;
        border-radius: 2px;
        flex-shrink: 0;
    }

    /* Market bar */
    .market-bar {
        background: var(--bg-panel);
        border: 1px solid var(--b-default);
        border-radius: 12px;
        margin-bottom: 36px;
        overflow: hidden;
    }

    .market-bar-head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 11px 20px;
        border-bottom: 1px solid var(--b-default);
        background: var(--bg-elevated);
    }

    .market-bar-title {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: var(--text-xs);
        font-weight: 700;
        color: var(--t-secondary);
        text-transform: uppercase;
        letter-spacing: 0.07em;
    }

    .market-bar-time {
        font-size: var(--text-xs);
        color: var(--t-muted);
        font-family: var(--mono);
    }

    .market-stats {
        display: flex;
        flex-wrap: wrap;
    }

    .market-stat {
        padding: 14px 22px;
        border-right: 1px solid var(--b-default);
        flex: 1;
        min-width: 110px;
    }

    .market-stat:last-child {
        border-right: none;
    }

    .market-stat-label {
        font-size: 10px;
        color: var(--t-muted);
        margin-bottom: 5px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.06em;
    }

    .market-stat-value {
        font-family: var(--mono);
        font-size: 15px;
        font-weight: 600;
        color: var(--t-white);
    }

    /* Status badges */
    .status-open {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 2px 10px;
        border-radius: var(--r-full);
        background: rgba(34, 197, 94, 0.1);
        border: 1px solid rgba(34, 197, 94, 0.25);
        font-size: var(--text-xs);
        font-weight: 700;
        color: var(--c-green);
    }

    .status-closed {
        display: inline-flex;
        align-items: center;
        gap: 5px;
        padding: 2px 10px;
        border-radius: var(--r-full);
        background: rgba(107, 114, 128, 0.1);
        border: 1px solid var(--b-default);
        font-size: var(--text-xs);
        font-weight: 700;
        color: var(--t-secondary);
    }

    /* Stock cards */
    .stocks-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(190px, 1fr));
        gap: 10px;
    }

    .stock-card {
        display: block;
        text-decoration: none;
        background: var(--bg-panel);
        border: 1px solid var(--b-default);
        border-radius: 12px;
        padding: 16px;
        transition: border-color var(--ease-md), transform var(--ease-md), box-shadow var(--ease-md);
        position: relative;
        overflow: hidden;
    }

    .stock-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        opacity: 0;
        transition: opacity var(--ease-md);
    }

    .stock-card.up-card::before {
        background: var(--c-green);
    }

    .stock-card.down-card::before {
        background: var(--c-red);
    }

    .stock-card:hover {
        border-color: var(--b-brand);
        transform: translateY(-2px);
        box-shadow: 0 8px 28px rgba(0, 0, 0, 0.22);
    }

    .stock-card:hover::before {
        opacity: 1;
    }

    .sc-top {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 10px;
    }

    .sc-code {
        font-family: var(--mono);
        font-size: var(--text-xs);
        font-weight: 700;
        padding: 2px 7px;
        border-radius: 4px;
        background: rgba(59, 130, 246, 0.1);
        color: var(--c-blue);
    }

    .sc-pct {
        font-size: var(--text-xs);
        font-weight: 700;
        font-family: var(--mono);
        padding: 2px 6px;
        border-radius: 4px;
    }

    .sc-pct.up {
        background: rgba(34, 197, 94, 0.1);
        color: var(--c-green);
    }

    .sc-pct.down {
        background: rgba(239, 68, 68, 0.1);
        color: var(--c-red);
    }

    .sc-name {
        font-size: 13px;
        font-weight: 600;
        color: var(--t-primary);
        margin-bottom: 10px;
    }

    .sc-price {
        font-family: var(--mono);
        font-size: 22px;
        font-weight: 700;
        margin-bottom: 2px;
    }

    .sc-price.up {
        color: var(--c-green);
    }

    .sc-price.down {
        color: var(--c-red);
    }

    .sc-price.neu {
        color: var(--t-white);
    }

    .sc-chg {
        font-size: var(--text-sm);
        font-family: var(--mono);
    }

    .sc-chg.up {
        color: var(--c-green);
    }

    .sc-chg.down {
        color: var(--c-red);
    }

    .sc-vol {
        font-size: var(--text-xs);
        color: var(--t-muted);
        margin-top: 10px;
        border-top: 1px solid var(--b-default);
        padding-top: 9px;
    }

    /* Tools grid */
    .tools-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
    }

    .tool-link {
        display: flex;
        align-items: center;
        gap: 14px;
        background: var(--bg-panel);
        border: 1px solid var(--b-default);
        border-radius: 12px;
        padding: 16px 18px;
        text-decoration: none;
        color: var(--t-primary);
        transition: border-color var(--ease-md), background var(--ease-md), transform var(--ease-md), box-shadow var(--ease-md);
    }

    .tool-link:hover {
        border-color: var(--b-brand);
        background: var(--bg-elevated);
        transform: translateY(-1px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.18);
    }

    .tool-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 17px;
        flex-shrink: 0;
    }

    .tool-name {
        font-size: 13px;
        font-weight: 600;
        color: var(--t-white);
        margin-bottom: 2px;
    }

    .tool-desc {
        font-size: var(--text-xs);
        color: var(--t-muted);
    }

    /* News grid */
    .news-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
    }

    .news-card {
        display: flex;
        flex-direction: column;
        background: var(--bg-panel);
        border: 1px solid var(--b-default);
        border-radius: 12px;
        overflow: hidden;
        text-decoration: none;
        color: inherit;
        transition: border-color var(--ease-md), transform var(--ease-md), box-shadow var(--ease-md);
    }

    .news-card:hover {
        border-color: var(--b-brand);
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    }

    .news-img {
        height: 130px;
        background: var(--bg-elevated);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--t-muted);
        font-size: 28px;
        overflow: hidden;
        flex-shrink: 0;
    }

    .news-img img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .news-body {
        padding: 14px 16px;
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .news-source {
        font-size: 10px;
        font-weight: 700;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: var(--c-blue);
        margin-bottom: 6px;
    }

    .news-title {
        font-size: 13px;
        font-weight: 600;
        color: var(--t-white);
        line-height: 1.55;
        margin-bottom: auto;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .news-time {
        font-size: var(--text-xs);
        color: var(--t-muted);
        margin-top: 10px;
        display: flex;
        align-items: center;
        gap: 4px;
    }

    @media (max-width: 900px) {
        .tools-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .news-grid {
            grid-template-columns: 1fr 1fr;
        }
    }

    @media (max-width: 600px) {
        .tools-grid {
            grid-template-columns: 1fr;
        }

        .news-grid {
            grid-template-columns: 1fr;
        }

        .market-stat {
            min-width: 50%;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero -->
<section class="hero">
    <div class="hero-bg"></div>
    <div class="hero-grid-bg"></div>
    <div class="container" style="position:relative;">
        <div class="hero-eyebrow">
            <span class="pulse-dot live"></span> 台灣股市即時數據
        </div>
        <h1 class="hero-title">
            專業台股分析<br><span class="accent">一站式</span>投資決策平台
        </h1>
        <p class="hero-sub">即時行情 · 技術指標 · AI 預測 · 智慧選股<br>讓數據成為你最好的投資夥伴</p>

        <div class="hero-search">
            <form action="{{ url_for('search_redirect') }}" method="GET">
                <div class="hero-search-box">
                    <input type="text" name="q" id="heroSearch" placeholder="輸入股票代號或名稱，例如：2330、台積電" autocomplete="off">
                    <button type="submit">
                        <i class="bi bi-search"></i> 查詢
                    </button>
                </div>
            </form>
        </div>
        <div class="quick-links">
            <a href="{{ url_for('stock_page', code='2330') }}" class="quick-link">台積電 2330</a>
            <a href="{{ url_for('stock_page', code='0050') }}" class="quick-link">元大50 0050</a>
            <a href="{{ url_for('stock_page', code='0056') }}" class="quick-link">高股息 0056</a>
            <a href="{{ url_for('stock_page', code='2317') }}" class="quick-link">鴻海 2317</a>
            <a href="{{ url_for('stock_page', code='2412') }}" class="quick-link">中華電 2412</a>
        </div>
    </div>
</section>

<!-- Main content -->
<div class="home-content">
    <div class="container">

        <!-- Market Summary -->
        {% if market_info %}
        <div class="market-bar fade-up">
            <div class="market-bar-head">
                <div class="market-bar-title">
                    <i class="bi bi-speedometer2"></i> 大盤行情
                    {% if market_open %}
                    <span class="status-open"><span class="pulse-dot live"></span> 交易中</span>
                    {% else %}
                    <span class="status-closed"><i class="bi bi-moon-fill" style="font-size:9px;"></i> 休市</span>
                    {% endif %}
                </div>
                <span class="market-bar-time">
                    <i class="bi bi-clock" style="font-size:10px;"></i>
                    {{ current_time.strftime('%H:%M 更新') }}
                </span>
            </div>
            <div class="market-stats">
                {% for key, value in market_info.items() %}
                {% set is_up = '+' in value|string %}
                {% set is_down = '-' in value|string %}
                <div class="market-stat">
                    <div class="market-stat-label">{{ key }}</div>
                    <div class="market-stat-value {% if is_up %}txt-up{% elif is_down %}txt-down{% endif %}">{{ value }}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Popular Stocks -->
        <div style="margin-bottom:44px;">
            <div class="sec-head">
                <div class="sec-title">
                    <div class="sec-title-bar" style="background:var(--c-red);"></div>
                    熱門股票
                </div>
                <a href="{{ url_for('stock_screener_tool') }}" class="btn btn-outline btn-sm">
                    探索更多 <i class="bi bi-arrow-right"></i>
                </a>
            </div>
            {% if popular_stocks %}
            <div class="stocks-grid">
                {% for stock in popular_stocks %}
                {% set is_up = '+' in stock.change|string and stock.change != 'N/A' %}
                {% set is_down = '-' in stock.change|string and stock.change != 'N/A' %}
                <a href="{{ url_for('stock_page', code=stock.code) }}"
                    class="stock-card fade-up fade-up-{{ loop.index if loop.index <= 4 else '4' }} {{ 'up-card' if is_up else 'down-card' if is_down else '' }}">
                    <div class="sc-top">
                        <span class="sc-code">{{ stock.code }}</span>
                        {% if stock.change_percent != 'N/A' %}
                        <span class="sc-pct {{ 'up' if is_up else 'down' if is_down else '' }}">
                            {{ '+' if is_up else '' }}{{ stock.change_percent }}
                        </span>
                        {% endif %}
                    </div>
                    <div class="sc-name">{{ stock.name }}</div>
                    <div class="sc-price {{ 'up' if is_up else 'down' if is_down else 'neu' }}">
                        {{ stock.price if stock.price != 'N/A' else '—' }}
                    </div>
                    <div class="sc-chg {{ 'up' if is_up else 'down' if is_down else '' }}">
                        {{ stock.change if stock.change != 'N/A' else '' }}
                    </div>
                    <div class="sc-vol">
                        <i class="bi bi-bar-chart-line"></i>
                        成交量 {{ stock.volume if stock.volume != 'N/A' else '—' }}
                    </div>
                </a>
                {% endfor %}
            </div>
            {% else %}
            <div class="card" style="padding:48px;text-align:center;">
                <i class="bi bi-wifi-off"
                    style="font-size:32px;color:var(--t-muted);display:block;margin-bottom:12px;"></i>
                <p style="color:var(--t-secondary);font-size:13px;">暫時無法取得股票資料</p>
            </div>
            {% endif %}
        </div>

        <!-- Investment Tools -->
        <div style="margin-bottom:44px;">
            <div class="sec-head">
                <div class="sec-title">
                    <div class="sec-title-bar" style="background:var(--c-blue);"></div>
                    投資工具套件
                </div>
            </div>
            <div class="tools-grid">
                <a href="{{ url_for('technical_analysis_tool') }}" class="tool-link fade-up fade-up-1">
                    <div class="tool-icon" style="background:rgba(59,130,246,0.12);color:#3B82F6;">
                        <i class="bi bi-bar-chart-fill"></i>
                    </div>
                    <div>
                        <div class="tool-name">技術分析</div>
                        <div class="tool-desc">RSI · MACD · 布林通道</div>
                    </div>
                </a>
                <a href="{{ url_for('ai_price_prediction_tool') }}" class="tool-link fade-up fade-up-2">
                    <div class="tool-icon" style="background:rgba(139,92,246,0.12);color:#8B5CF6;">
                        <i class="bi bi-cpu-fill"></i>
                    </div>
                    <div>
                        <div class="tool-name">AI 價格預測</div>
                        <div class="tool-desc">趨勢外推 · 信賴區間</div>
                    </div>
                </a>
                <a href="{{ url_for('stock_screener_tool') }}" class="tool-link fade-up fade-up-3">
                    <div class="tool-icon" style="background:rgba(249,115,22,0.12);color:#F97316;">
                        <i class="bi bi-funnel-fill"></i>
                    </div>
                    <div>
                        <div class="tool-name">智慧選股</div>
                        <div class="tool-desc">PE · 殖利率 · ROE 篩選</div>
                    </div>
                </a>
                <a href="{{ url_for('dividend_calculator') }}" class="tool-link fade-up fade-up-1">
                    <div class="tool-icon" style="background:rgba(20,184,166,0.12);color:#14B8A6;">
                        <i class="bi bi-calculator-fill"></i>
                    </div>
                    <div>
                        <div class="tool-name">股息計算器</div>
                        <div class="tool-desc">殖利率 · 配息試算 · 複利</div>
                    </div>
                </a>
                <a href="{{ url_for('dca_tool') }}" class="tool-link fade-up fade-up-2">
                    <div class="tool-icon" style="background:rgba(34,197,94,0.1);color:#22C55E;">
                        <i class="bi bi-cash-coin"></i>
                    </div>
                    <div>
                        <div class="tool-name">定期定額試算</div>
                        <div class="tool-desc">長期複利 · 成長曲線</div>
                    </div>
                </a>
                <a href="{{ url_for('allocation_tool') }}" class="tool-link fade-up fade-up-3">
                    <div class="tool-icon" style="background:rgba(59,130,246,0.12);color:#3B82F6;">
                        <i class="bi bi-pie-chart-fill"></i>
                    </div>
                    <div>
                        <div class="tool-name">資產配置</div>
                        <div class="tool-desc">投資組合 · 風險分配</div>
                    </div>
                </a>
            </div>
        </div>

        <!-- News -->
        <div>
            <div class="sec-head">
                <div class="sec-title">
                    <div class="sec-title-bar" style="background:var(--c-gold);"></div>
                    市場新聞
                </div>
                <a href="{{ url_for('news_page') }}" class="btn btn-outline btn-sm">
                    更多新聞 <i class="bi bi-arrow-right"></i>
                </a>
            </div>
            {% if market_news %}
            <div class="news-grid">
                {% for news in market_news %}
                <a href="{{ news.link }}" target="_blank" rel="noopener" class="news-card fade-up">
                    <div class="news-img">
                        {% if news.image_url %}
                        <img src="{{ news.image_url }}" alt="{{ news.title }}" loading="lazy">
                        {% else %}
                        <i class="bi bi-newspaper"></i>
                        {% endif %}
                    </div>
                    <div class="news-body">
                        <div class="news-source"><i class="bi bi-rss-fill" style="font-size:9px;"></i> {{ news.source }}
                        </div>
                        <div class="news-title">{{ news.title }}</div>
                        <div class="news-time"><i class="bi bi-clock"></i> {{ news.published_at }}</div>
                    </div>
                </a>
                {% endfor %}
            </div>
            {% else %}
            <div class="card" style="padding:48px;text-align:center;">
                <i class="bi bi-newspaper"
                    style="font-size:32px;color:var(--t-muted);display:block;margin-bottom:12px;"></i>
                <p style="color:var(--t-secondary);font-size:13px;">目前沒有最新新聞</p>
            </div>
            {% endif %}
        </div>

    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('keydown', e => {
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            document.getElementById('heroSearch')?.focus();
        }
    });
</script>
{% endblock %}